#! /usr/bin/env python

import os.path
import sys
sys.path.append(
    os.path.abspath(os.path.join(os.path.dirname(__file__), "..", "lib"))
)

import argparse
import logging

parser = argparse.ArgumentParser()

parser.add_argument(
    '-v',
    help="Print logs from DEBUG level and up",
    action="store_const", dest="loglevel", const=logging.DEBUG,
    default=logging.INFO,
)

args = parser.parse_args()

# setup global log level
logging.basicConfig(
    level=args.loglevel,
    format= "[%(asctime)s] %(levelname)s [%(name)s.%(funcName)s:%(lineno)d] %(message)s",
    datefmt="%H:%M:%S"
)

# do the work

from cat.xhpy.xhpycompiler import XHPyCompiler
from cat.server import WebServer

XHPyCompiler.compile(
    add_gitignore=(
        os.path.abspath(
            os.path.join(os.path.dirname(__file__), "..")
        ),
        os.path.abspath(
            os.path.join(os.path.dirname(__file__), "..", ".gitignore")
        )
    )
)
WebServer.start()